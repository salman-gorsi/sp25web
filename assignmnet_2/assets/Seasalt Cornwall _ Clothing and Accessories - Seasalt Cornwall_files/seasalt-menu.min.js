define(["ko","Magento_Customer/js/customer-data","gsap","matchMedia"],function(ko,customerData){"use strict";const mobileMenuWrapper=document.querySelector(".seasalt-menu-mobile-wrapper");const openMobileMenuBtn=document.querySelector("span.action.nav-toggle");const closeMobileMenuBtn=document.querySelectorAll(".close-mobile-menu");const backButton=document.querySelector("button.seasalt-menu-mobile__header-back");const mobileMenuLinksWithChildren=document.querySelectorAll(".seasalt-menu-mobile__inner-item--level1.seasalt-menu-mobile__inner-item--parent");const mobileHeader=document.querySelector(".seasalt-menu-mobile__header");const mobileSubmenuHeader=document.querySelector(".seasalt-menu-mobile__menu-header");const mobileMenuParent=document.querySelectorAll(".seasalt-menu-mobile__item--parent");const linkWithDropdown=document.querySelectorAll(".seasalt-menu-desktop__item--parent");const pageHeader=document.querySelector('header.page-header');let pageHeaderHeight=ko.observable(pageHeader.offsetHeight);let resizeObserversInitiated=false;let lastHoveredItem=null;let mobileConfig={activeSubmenu:ko.observable(null),activeSubmenuHeading:ko.observable(null),activeSubmenuHeadingUrl:ko.observable(null)};let currentHoverItem=ko.observable(null);init();function init(){setInitialElementState();initSubscribers();initEventListeners();}
function initResizeObservers(){if(resizeObserversInitiated===true){return}
const headerResizeObserver=new ResizeObserver(handleHeaderResize);headerResizeObserver.observe(pageHeader);resizeObserversInitiated=true;}
function handleHeaderResize(entries){if(currentHoverItem()===null){return}
for(const entry of entries){if(pageHeaderHeight()!==entry.contentRect.height){pageHeaderHeight(entry.contentRect.height);}}}
function setInitialElementState(){gsap.set(mobileHeader,{xPercent:0,x:0,});gsap.set(mobileSubmenuHeader,{xPercent:100,x:0,});gsap.set(mobileMenuWrapper,{xPercent:-100,x:0,});gsap.set("nav.seasalt-menu-mobile",{xPercent:0,x:0,});gsap.set("seasalt-menu-mobile__inner-list--level2",{height:0,});}
function initSubscribers(){const customer=customerData.get('customer');mobileConfig.activeSubmenu.subscribe(function(activeSubmenu){if(activeSubmenu!=null){openActiveSubmenu();}});mobileConfig.activeSubmenuHeading.subscribe(function(){updateMobileMenuHeader();});mobileConfig.activeSubmenuHeading.subscribe(function(){updateMobileMenuHeader();});customer.subscribe(function(data){handleLoginMessage(data)});customerData.reload(['customer']);}
function handleLoginMessage(customerData){const loginButtons=document.querySelector('.seasalt-menu-mobile__account-buttons');const loginWelcomeMessage=document.querySelector('.seasalt-menu-mobile__account-welcome');const customerFirstName=document.querySelector('.seasalt-menu-mobile__account-name');const signoutLink=document.querySelector('.seasalt-menu-mobile-quicklinks .sign-out');if(customerData.logged_in&&customerData.logged_in===true){loginButtons.style.display='none';loginWelcomeMessage.style.display='flex';if(signoutLink){signoutLink.style.display='inline-block';}
if(customerFirstName&&customerData.firstname){customerFirstName.innerText=`Welcome, ${customerData.firstname}`;}}else{loginButtons.style.display='flex';loginWelcomeMessage.style.display='none';if(signoutLink){signoutLink.style.display='none';}}}
function openActiveSubmenu(){mobileConfig.activeSubmenu().style.display="block";mobileMenuWrapper.classList.add('disable-scroll');mobileMenuWrapper.scroll({top:0,});gsap.to(mobileHeader,{xPercent:-100,duration:0.5,});gsap.to("nav.seasalt-menu-mobile",{xPercent:-100,duration:0.5});gsap.fromTo(mobileSubmenuHeader,{xPercent:100},{xPercent:0,duration:0.5});}
function closeOpenSubMenus(){const openSubmenus=document.querySelectorAll(".seasalt-menu-mobile__inner-item--level1[data-active='true']");openSubmenus.forEach((submenu)=>{const innerMenu=submenu.querySelector('.seasalt-menu-mobile__inner-list--level2');submenu.removeAttribute('data-active');innerMenu.style.height='0';});}
function closeActiveSubMenu(){const tl=gsap.timeline({onComplete:function(){if(mobileConfig.activeSubmenu()){mobileConfig.activeSubmenu().style.display="none";setActiveSubmenu(null);setActiveSubmenuHeading(null);closeOpenSubMenus();}},});gsap.to(mobileHeader,{xPercent:0,duration:0.5});gsap.fromTo(mobileSubmenuHeader,{xPercent:0},{xPercent:100,duration:0.5});tl.to("nav.seasalt-menu-mobile",{xPercent:0,duration:0.5});mobileMenuWrapper.classList.remove('disable-scroll');}
function initEventListeners(){openMobileMenuBtn.addEventListener("click",openMobileMenu);closeMobileMenuBtn.forEach((button)=>button.addEventListener("click",closeMobileMenu));if(backButton){backButton.addEventListener("click",closeActiveSubMenu);}
mobileMenuLinksWithChildren.forEach((link)=>{link.querySelector('.seasalt-menu-mobile__inner-link').addEventListener("click",function(e){const submenu=link.querySelector("ul");const submenuLinks=submenu.querySelectorAll('a.seasalt-menu-mobile__inner-link');submenuLinks.forEach(function(link){link.addEventListener('click',function(e){e.stopPropagation();})});e.preventDefault();if(link.dataset.active==='true'){gsap.to(submenu,{height:0,duration:0.3})
link.dataset.active='false';}else{gsap.to(submenu,{height:"auto",duration:0.3})
link.dataset.active='true';}});});linkWithDropdown.forEach((item)=>{item.addEventListener("mouseenter",handleMouseEnter);item.addEventListener("mouseleave",handleMouseLeave);});}
function setActiveSubmenu(submenu){mobileConfig.activeSubmenu(submenu);}
function setActiveSubmenuHeading(heading){mobileConfig.activeSubmenuHeading(heading);}
function setActiveSubmenuHeadingUrl(url){mobileConfig.activeSubmenuHeadingUrl(url);}
function closeMobileMenu(){enableBodyScroll();closeActiveSubMenu();removeDropdownOverlay();gsap.fromTo(mobileMenuWrapper,{xPercent:0},{xPercent:-100,duration:0.4});}
function openMobileMenu(){disableBodyScroll();addDropdownOverlay();gsap.fromTo(mobileMenuWrapper,{xPercent:-100},{xPercent:0,duration:0.4});}
function disableBodyScroll(){if(window.innerWidth<768){document.body.classList.add('disable-scroll');}}
function enableBodyScroll(){if(window.innerWidth<768){document.body.classList.remove('disable-scroll');}}
mobileMenuParent.forEach((link)=>{const parentLink=link.querySelector("a.seasalt-menu-mobile__link");const submenu=link.querySelector("ul.seasalt-menu-mobile__inner-list--level1");parentLink.style.cssText="pointer-events:none";link.addEventListener("click",function(e){const self=this;const linkUrl=function(){const linkTag=self.querySelector('a.seasalt-menu-mobile__link');if(linkTag){if(!linkTag.href.endsWith("#")){return linkTag.href;}else{return null;}}else{return null;}}
if(e.target.classList.contains("seasalt-menu-mobile__item--parent")){setActiveSubmenu(submenu);setActiveSubmenuHeadingUrl(linkUrl());setActiveSubmenuHeading(parentLink.innerText);}});});function updateMobileMenuHeader(){const mobileHeaderHeading=document.querySelector(".seasalt-menu-mobile__submenu-heading");if(mobileConfig.activeSubmenuHeadingUrl()){mobileHeaderHeading.innerHTML=`<a href="${mobileConfig.activeSubmenuHeadingUrl()}">${mobileConfig.activeSubmenuHeading()}</a>`;}else{mobileHeaderHeading.innerHTML=`${mobileConfig.activeSubmenuHeading()}`;}}
function handleMouseEnter(event){const dropdown=event.currentTarget.querySelector(".seasalt-menu-desktop__inner-list--level1");if(dropdown){dropdown.classList.add("active");dropdown.style.cssText="opacity: 1; visibility: visible";addDropdownOverlay();currentHoverItem(event.currentTarget);}}
function handleMouseLeave(event){hideDropdowns();}
function hideDropdowns(){const activeDropdowns=document.querySelectorAll(".seasalt-menu-desktop__inner-list--level1.active");activeDropdowns.forEach((dropdown)=>{dropdown.classList.remove("active");dropdown.style.visibility="hidden";dropdown.style.opacity="0";});removeDropdownOverlay();}
function removeDropdownOverlay(){document.body.classList.remove("seasalt-menu-open");enableBodyScroll();}
function addDropdownOverlay(){document.body.classList.add("seasalt-menu-open");}
function handleBackgroundOverlay(device){const header=document.querySelector('header.page-header');const overlay=function(){if(document.querySelector('.seasalt-menu-bg-overlay')){return document.querySelector('.seasalt-menu-bg-overlay');}else{const overlay=document.createElement('div');overlay.classList.add('seasalt-menu-bg-overlay');return overlay;}}
if(device==='mobile'){header.append(overlay());}else if(device==='desktop'){document.body.append(overlay());}
overlay().addEventListener('click',closeMobileMenu);}
mediaCheck({media:'(min-width: 1024px)',entry:function mediaCheckDesktop(){handleBackgroundOverlay('desktop');initResizeObservers();closeMobileMenu();},exit:function mediaCheckMobile(){handleBackgroundOverlay('mobile');}});});