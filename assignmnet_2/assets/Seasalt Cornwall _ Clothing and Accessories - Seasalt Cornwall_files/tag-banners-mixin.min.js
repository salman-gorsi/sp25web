define(["jquery","mage/utils/wrapper","Magento_GoogleTagManager/js/google-tag-manager",],function($,wrapper){"use strict";return function(target){let viewedBanners=[];let bannersData;function notifyClick(banner){window.dataLayer.push({event:"PLA",type:banner.gtmType,name:banner.name,URL:banner.link,eventType:"click",});}
function notifyImpression(banner){window.dataLayer.push({event:"PLA",type:banner.gtmType,name:banner.name,eventType:"impression",});}
function getBannerData(bannerId){let data;if(bannersData&&bannersData[bannerId]){data={id:bannerId,gtmType:bannersData[bannerId].gtm_type||"undefined",name:bannersData[bannerId].rule_name,link:bannersData[bannerId].link,};}else{data={id:bannerId,gtmType:"undefined",name:"undefined",link:"undefined",};}
return data;}
function onBannerClick(e){const closestLink=$(e.target).closest("a");const bannerId=$(this).attr("data-banner-id");const data=getBannerData(bannerId);if(data.link==""&&closestLink){data.link=closestLink.attr('href');}
window.dataLayer=window.dataLayer||[];notifyClick(data);}
function onBannerBecomesVisible(el){const bannerId=el.getAttribute("data-banner-id");if(!viewedBanners.includes(bannerId)){viewedBanners.push(bannerId);const data=getBannerData(bannerId);window.dataLayer=window.dataLayer||[];notifyImpression(data);}}
target.init=wrapper.wrapSuper(target.init,function(){this._super();bannersData=this.data&&this.data.injectorParams&&this.data.injectorParams.banners;$("[data-banner-id]").click(onBannerClick);const intersectionCallback=(entries,observer)=>{entries.forEach((entry)=>{if(entry.isIntersecting){onBannerBecomesVisible(entry.target);}});};const intersectionOptions={root:null,rootMargin:"0px",threshold:0.75,};const observer=new window.IntersectionObserver(intersectionCallback,intersectionOptions);document.querySelectorAll("[data-banner-id]").forEach((el)=>observer.observe(el));});return target;};});