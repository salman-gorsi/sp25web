define(['jquery','uiComponent','Magento_Customer/js/customer-data',],function($,Component,customerData){'use strict';return Component.extend({defaults:{customerDataExists:false},initialize:function(config){if(config.enabled==='0')return;const self=this;this._super();self.getInsiderUserData();const customer=customerData.get('customer');customer.subscribe(function(){self.getInsiderUserData();},this);},getInsiderUserData:function(){const customer=customerData.get('customer')();const guestData=$.parseJSON($.mage.cookies.get('guest_data'));if(customer.logged_in&&!self.customerDataExists){let insiderObjectData={...customer};this.createInsiderUserObject(insiderObjectData);self.customerDataExists=true;}else if(!customer.logged_in&&guestData){this.createInsiderUserObject(guestData);this.customerDataExists=true;}
$(window).trigger('seasalt:insider:load');},createInsiderUserObject:function(data){const insiderUserObject={"gdpr_optin":true,"email":data.email};this.addToInsiderObject(insiderUserObject);},addToInsiderObject:function(object){window.insider_object=window.insider_object||{};window.insider_object.user=object;}});});